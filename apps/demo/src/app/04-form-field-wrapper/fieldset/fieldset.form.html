<div class="mb-6 text-center">
  <p class="text-sm text-gray-600 dark:text-gray-400">
    Group related form fields and display aggregated validation errors
  </p>
</div>

<form
  [ngxSignalForm]="fieldsetForm"
  [errorStrategy]="errorDisplayMode"
  (submit)="saveData($event)"
  class="form-container"
>
  <!-- Shipping Address Fieldset -->
  <fieldset
    ngxSignalFormFieldset
    [fieldsetField]="fieldsetForm.shippingAddress"
    fieldsetId="shipping-address"
    class="fieldset-demo"
    includeNestedErrors
  >
    <legend class="fieldset-legend">Shipping Address</legend>
    <p class="fieldset-description">
      Errors from all address fields are aggregated below the fieldset.
    </p>

    <div class="grid gap-4 sm:grid-cols-2">
      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.shippingAddress.street"
        class="sm:col-span-2"
      >
        <label for="shippingStreet">Street Address *</label>
        <input
          id="shippingStreet"
          type="text"
          [formField]="fieldsetForm.shippingAddress.street"
          placeholder="123 Main Street"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.shippingAddress.city"
      >
        <label for="shippingCity">City *</label>
        <input
          id="shippingCity"
          type="text"
          [formField]="fieldsetForm.shippingAddress.city"
          placeholder="New York"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.shippingAddress.zipCode"
      >
        <label for="shippingZipCode">ZIP Code *</label>
        <input
          id="shippingZipCode"
          type="text"
          [formField]="fieldsetForm.shippingAddress.zipCode"
          placeholder="10001"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.shippingAddress.country"
        class="sm:col-span-2"
      >
        <label for="shippingCountry">Country *</label>
        <select
          id="shippingCountry"
          [formField]="fieldsetForm.shippingAddress.country"
        >
          @for (country of countries; track country.value) {
          <option [value]="country.value">{{ country.label }}</option>
          }
        </select>
      </ngx-signal-form-field-wrapper>
    </div>
  </fieldset>

  <!-- Same as Shipping Checkbox -->
  <div class="my-6">
    <label class="flex cursor-pointer items-center gap-2">
      <input
        type="checkbox"
        class="form-checkbox"
        [formField]="fieldsetForm.billingSameAsShipping"
      />
      <span class="text-sm">Billing address is the same as shipping</span>
    </label>
  </div>

  <!-- Billing Address Fieldset - Shown when different from shipping -->
  @if (!fieldsetForm.billingSameAsShipping().value()) {
  <fieldset
    ngxSignalFormFieldset
    [fieldsetField]="fieldsetForm.billingAddress"
    fieldsetId="billing-address"
    class="fieldset-demo"
    includeNestedErrors
  >
    <legend class="fieldset-legend">Billing Address</legend>
    <p class="fieldset-description">
      Separate billing address for invoice delivery.
    </p>

    <div class="grid gap-4 sm:grid-cols-2">
      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.billingAddress.street"
        class="sm:col-span-2"
      >
        <label for="billingStreet">Street Address *</label>
        <input
          id="billingStreet"
          type="text"
          [formField]="fieldsetForm.billingAddress.street"
          placeholder="456 Business Ave"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.billingAddress.city"
      >
        <label for="billingCity">City *</label>
        <input
          id="billingCity"
          type="text"
          [formField]="fieldsetForm.billingAddress.city"
          placeholder="Los Angeles"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.billingAddress.zipCode"
      >
        <label for="billingZipCode">ZIP Code *</label>
        <input
          id="billingZipCode"
          type="text"
          [formField]="fieldsetForm.billingAddress.zipCode"
          placeholder="90001"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.billingAddress.country"
        class="sm:col-span-2"
      >
        <label for="billingCountry">Country *</label>
        <select
          id="billingCountry"
          [formField]="fieldsetForm.billingAddress.country"
        >
          @for (country of countries; track country.value) {
          <option [value]="country.value">{{ country.label }}</option>
          }
        </select>
      </ngx-signal-form-field-wrapper>
    </div>
  </fieldset>
  }

  <!-- Delivery Method Fieldset -->
  <fieldset
    ngxSignalFormFieldset
    [fieldsetField]="fieldsetForm.delivery"
    fieldsetId="delivery-method"
    class="fieldset-demo"
  >
    <legend class="fieldset-legend">Delivery Method</legend>
    <p class="fieldset-description">Select how you want the order delivered.</p>

    <fieldset
      ngxSignalFormFieldset
      [fieldsetField]="fieldsetForm.delivery.method"
      fieldsetId="delivery-method-options"
      class="space-y-3"
    >
      <legend class="form-label">Delivery option *</legend>

      <label class="flex cursor-pointer items-center gap-2">
        <input
          type="radio"
          class="form-radio"
          [formField]="fieldsetForm.delivery.method"
          value="standard"
        />
        <span class="text-sm">Standard (3-5 business days)</span>
      </label>

      <label class="flex cursor-pointer items-center gap-2">
        <input
          type="radio"
          class="form-radio"
          [formField]="fieldsetForm.delivery.method"
          value="express"
        />
        <span class="text-sm">Express (1-2 business days)</span>
      </label>

      <label class="flex cursor-pointer items-center gap-2">
        <input
          type="radio"
          class="form-radio"
          [formField]="fieldsetForm.delivery.method"
          value="pickup"
        />
        <span class="text-sm">Local pickup</span>
      </label>
    </fieldset>
  </fieldset>

  <!-- Credentials Fieldset -->
  <fieldset
    ngxSignalFormFieldset
    [fieldsetField]="fieldsetForm.credentials"
    fieldsetId="credentials"
    class="fieldset-demo"
    includeNestedErrors
  >
    <legend class="fieldset-legend">Account Credentials</legend>
    <p class="fieldset-description">
      Cross-field validation: passwords must match. Errors shown at group level.
    </p>

    <div class="grid gap-4 sm:grid-cols-2">
      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.credentials.password"
      >
        <label for="password">Password *</label>
        <input
          id="password"
          type="password"
          [formField]="fieldsetForm.credentials.password"
          placeholder="Enter password (min 8 chars)"
          autocomplete="new-password"
        />
      </ngx-signal-form-field-wrapper>

      <ngx-signal-form-field-wrapper
        [formField]="fieldsetForm.credentials.confirmPassword"
      >
        <label for="confirmPassword">Confirm Password *</label>
        <input
          id="confirmPassword"
          type="password"
          [formField]="fieldsetForm.credentials.confirmPassword"
          placeholder="Confirm your password"
          autocomplete="new-password"
        />
      </ngx-signal-form-field-wrapper>
    </div>
  </fieldset>

  <!-- Form Actions -->
  <div class="mt-8 flex items-center gap-4">
    <button
      class="btn-primary"
      type="submit"
      [disabled]="fieldsetForm().pending()"
    >
      @if (fieldsetForm().pending()) { Saving... } @else { Submit Order }
    </button>

    <button class="btn-secondary" type="reset" (click)="resetForm()">
      Reset
    </button>

    <div class="ml-auto text-sm text-gray-600 dark:text-gray-400">
      @if (fieldsetForm().valid()) {
      <span class="text-green-600 dark:text-green-400">âœ“ All fields valid</span>
      } @else {
      <span>* Required fields</span>
      }
    </div>
  </div>
</form>
